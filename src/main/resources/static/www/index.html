<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1; user-scalable=no">
    <meta name="description" content="OTP Broker">
    <meta name="author" content="Planetbiru">
    <meta name="require-login" content="true" data-file="/login-form.html">
    <link rel="icon" href="favicon.ico">  
    <title>OTP Broker</title>
    <link href="lib.assets/css/bootstrap.css" rel="stylesheet">
    <link href="lib.assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="lib.assets/css/navbar.css" rel="stylesheet">
    <link href="lib.assets/css/style.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <script src="lib.assets/js/ie-emulation-modes-warning.js"></script>
    <script src="lib.assets/js/ie10-viewport-bug-workaround.js"></script>    
    <script src="lib.assets/js/jquery.min.js"></script>
    <script src="lib.assets/js/bootstrap.js"></script>
    <script src="lib.assets/js/ws.js"></script>
    <script>
      function handleIncommingMessage(message)
      {
        console.log("handleIncommingMessage", message);     
      }      
    </script>
  </head>

  <body>
    <div class="container">

      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="./">OTP Broker</a>
          </div>
          
                  <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active "><a href="./">Home</a></li>
              <li class=""><a href="ussd.html">USSD</a></li>
              <li class=""><a href="sms.html">SMS</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Settings <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li class=""><a href="admin.html">Administrator Setting</a></li>
                  <li class=""><a href="feeder-setting.html">Feeder Setting</a></li>
                  <li class=""><a href="sms-setting.html">SMS Setting</a></li>
                  <li class=""><a href="email-setting.html">Email Setting</a></li>
                  <li class=""><a href="api-user.html">API User</a></li>
                  <li class=""><a href="ddns-record.html">DDNS Record</a></li>
                  <li role="separator" class="divider"></li>
                  <li class="dropdown-header">Other Configs</li>
                  <li class=""><a href="network-setting.html">Network Setting</a></li>
                  <li class=""><a href="cloudflare.html">Cloudflare</a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li class=""><a href="account.html">Account</a></li>
              <li><a href="logout.html">Logout</a></li>
            </ul>
        </div>
 
        </div>
        <!--/.container-fluid -->
      </nav>
      <style>
        .server-into-item{
          position: relative;
          margin-bottom: 10px;
        }
        .info-label{
          padding: 4px 0;
        }
        .info-value{
          position: absolute;
          right: 0;
          text-align: right;
          top: 4px;
        }
        .info-progress{
          width: 100%;
          border: 1px solid #DDDDDD;
          background-color: #FEFEFE;
          border-radius:5px;
        }
        .info-progress-inner{
          height: 10px;
          background-color: #2984f9;
          box-sizing: border-box;
          position: relative;
        }
      </style>
      <div class="phone-page">
        <div>
          <div class="server-into-item cpu-usage">
            <div class="info-label">CPU Usage</div>
            <div class="info-value">0%</div>
            <div class="info-progress">
              <div class="info-progress-inner" style="width:0%"></div>
            </div>
          </div>
          <div class="cpu-temperature">
            <div class="info-label">CPU Temperature</div>
            <div class="cpu-temperature-container">
            <div class="server-into-item">
              <div class="info-label">Core</div>
              <div class="info-value">C</div>
              <div class="info-progress">
                <div class="info-progress-inner" style="width:0%"></div>
              </div>
            </div>
          </div>
          </div>
          <div class="server-into-item ram">
            <div class="info-label">RAM</div>
            <div class="info-value"></div>
            <div class="info-progress">
              <div class="info-progress-inner" style="width:0%"></div>
            </div>
          </div>
          <div class="server-into-item swap">
            <div class="info-label">SWAP</div>
            <div class="info-value"></div>
            <div class="info-progress">
              <div class="info-progress-inner" style="width:0%"></div>
            </div>
          </div>
          <div class="server-into-item storage">
            <div class="info-label">Storage</div>
            <div class="info-value"></div>
            <div class="info-progress">
              <div class="info-progress-inner" style="width:0%"></div>
            </div>
          </div>
        </div>

        <script>
          $(document).ready(function(e){
            loadData();
          });

          setInterval(function(e2){
            reloadData();
          }, 10000);
          function loadData()
          {
            $.ajax({
              type: "GET",
              url: "server-info/get",
              dataType: "json",
              success: function (data) {
                updateCPUUsage(data);
                updateRAMStatus(data);
                updateSWAPStatus(data);
                updateStorageStatus(data);
                createCPUCore(data);
                updateCPUTemperatureStatus(data);
              }
          });
          }
          function reloadData()
          {
            $.ajax({
              type: "GET",
              url: "server-info/get",
              dataType: "json",
              success: function (data) {
                updateCPUUsage(data);
                updateRAMStatus(data);
                updateSWAPStatus(data);
                updateStorageStatus(data);
                updateCPUTemperatureStatus(data);
              }
          });
          }

          

          function createCPUCore(data)
          {
            $('.cpu-temperature-container').empty();
            for(var i in data.cpu.temperature)
            {
              var core = data.cpu.temperature[i];
              var label = core.label;
              var percent = 100 * core.value.currentTemperature / 150;
              var cls = label.split(' ').join('-').toLowerCase();
              var html = '<div class="server-into-item '+cls+'">\r\n'+
              '<div class="info-label">'+label+'</div>\r\n'+
              '<div class="info-value">'+core.raw.currentTemperature+'</div>\r\n'+
              '<div class="info-progress">\r\n'+
              '  <div class="info-progress-inner" style="width:'+percent+'%"></div>\r\n'+
              '</div>\r\n'+
              '</div>\r\n';
              $('.cpu-temperature-container').append(html);
            }
          }
          function updateCPUTemperatureStatus(data)
          {
            for(var i in data.cpu.temperature)
            {
              var core = data.cpu.temperature[i];
              var label = core.label;
              var percent = 100 * core.value.currentTemperature / 150;
              var cls = label.split(' ').join('-').toLowerCase();
              $('.cpu-temperature-container').find('.'+cls).find('.info-value').text(core.raw.currentTemperature);
              $('.cpu-temperature-container').find('.'+cls).find('.info-progress-inner').css({'width':percent+'%'});
            }
          }
          function updateRAMStatus(data)
          {
            var percentRAM = 100 * (data.memory.ram.used/data.memory.ram.total);
            var totalRAM = data.memory.ram.total/(1024 * 1024);
            var usedRAM = data.memory.ram.used/(1024 * 1024);
            $('.ram').find('.info-value').text(percentRAM.toFixed(2)+"% ("+usedRAM.toFixed(2)+"GB / "+totalRAM.toFixed(2)+"GB"+")");
            $('.ram').find('.info-progress-inner').css({'width': percentRAM.toFixed(2)+'%'});
          }
          function updateSWAPStatus(data)
          {
            var percentSWAP = 100 * (data.memory.swap.used/data.memory.swap.total);
            var totalSWAP = data.memory.swap.total/(1024 * 1024);
            var usedSWAP = data.memory.swap.used/(1024 * 1024);
            $('.swap').find('.info-value').text(percentSWAP.toFixed(2)+"% ("+usedSWAP.toFixed(2)+"GB / "+totalSWAP.toFixed(2)+"GB"+")");
            $('.swap').find('.info-progress-inner').css({'width': percentSWAP.toFixed(2)+'%'});
          }
          
          function updateStorageStatus(data)
          {
            var percentStorage = 100 * (data.storage.used/data.storage.total);
            var totalStorage = data.storage.total/(1024 * 1024);
            var usedStorage = data.storage.used/(1024 * 1024);
            $('.storage').find('.info-value').text(percentStorage.toFixed(2)+"% ("+usedStorage.toFixed(2)+"GB / "+totalStorage.toFixed(2)+"GB"+")");
            $('.storage').find('.info-progress-inner').css({'width': percentStorage.toFixed(2)+'%'});
          }
          function updateCPUUsage(data)
          {
            var percentUsage = data.cpu.usage.used;
            $('.cpu-usage').find('.info-value').text(percentUsage.toFixed(2)+"%");
            $('.cpu-usage').find('.info-progress-inner').css({'width': percentUsage.toFixed(2)+'%'});
          }

        </script>

      </div>
    </div>
    <!-- /container -->
  </div>
</body>
</html>