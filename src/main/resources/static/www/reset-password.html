<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">
    <title>Register</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="lib.assets/css/iconfont.css">
    <link rel="stylesheet" href="lib.assets/css/home.css">

    <script src="lib.assets/js/jquery.min.js"></script>
    <script src="lib.assets/js/public.js"></script>

</head>
<body class="body">
<section class="bg">
  <div class="content">
    <div class="header-icon">
      <a href="./">
        <i class="iconfont icon_logo"></i>
      </a>
    </div>
    <div class="from-content">
      <h1>Reset SMS Gateway Password</h1>
      <div class="from">
        <div class="from-list">
          <input id="phone" type="text" placeholder="Phone Number" data-text="Please enter a valid phone number." autocomplete="off">
        </div>
        <div class="from-list">
          <input id="password" type="password" placeholder="Password" data-text="The password must be between 6-20 characters long." autocomplete="off">
        </div>
        <div class="from-list">
          <input id="cofPassword" type="password" placeholder="Confirm Password" data-text="Password does not match." autocomplete="off">
        </div>
        <p class="tip tip-signup" id="agree" data-text="Please read and accept the User Agreement.">
          <span class="icon iconfont"></span>
          <span>By signing up, I agree to <a href="tos.html" target="_blank">Terms of Service.</a></span>
        </p>
        <p class="error-message" style="opacity: 1;">Please enter a valid phone number.</p>
        <div class="submit-btn">
          <button id="register">Continue</button>
        </div>
        <p class="tip signup-tip">
          <a href="login-form.html">Back to login form</a>
        </p>
      </div>
    </div>
  </div>
</section>

<script>
  var next = '/';
  var source = '';
  var $phone = $('#phone');
  var $password = $('#password');
  var $cofPassword = $('#cofPassword');
  var $register = $('#register');
  var $agree = $('#agree');
  var $errorMessage = $('.error-message');
  var agree = false;

  $phone.blur(function () {
    var phone = $phone.val().trim();
    if (!verifyPhone(phone)) {
      setErr($phone, $(this).data('text'), $errorMessage);
    } else {
      clearErr($phone);
    }
  });

  $phone.keydown(function (e) {
    if (e.which === 13) {
      $password.focus();
    }
  });

  $password.blur(function () {
    var password = $password.val();
    if (password.length < 6 || password.length > 20) {
      setErr($password, $(this).data('text'), $errorMessage);
    } else {
      clearErr($password);
    }
  });

  $password.keydown(function (e) {
    if (e.which === 13) {
      $cofPassword.focus();
    }
  });

  $cofPassword.blur(function () {
    var password = $password.val();
    var cofPassword = $cofPassword.val();
    if (password !== cofPassword) {
      setErr($cofPassword, $(this).data('text'), $errorMessage);
    } else {
      clearErr($cofPassword);
    }
  });

  $cofPassword.keydown(function (e) {
    if (e.which === 13) {
      $register.click();
    }
  });

  $agree.click(function () {
    if (agree) {
      $(this).removeClass('agree');
      $(this).find('.iconfont').removeClass('icon_check_tick');
      $(this).find('.iconfont').addClass('icon');
      agree = false;
    } else {
      $(this).addClass('agree');
      $(this).find('.iconfont').addClass('icon_check_tick');
      $(this).find('.iconfont').removeClass('icon');
      agree = true;
    }
  });

  function register(regData) {
    showLoading();
    $.post('login-form.html', regData, function (res) {
      hideLoading();
      if (res.code === 0) {
        window.location.href = res.payload.nextURL;
        return;
      }
      $register.removeAttr('disabled');
      showErr(res.message);
    });
  }

  $register.click(function () {
    var phone = $phone.val().trim();
    var password = $password.val();
    var cofPassword = $cofPassword.val();

    if (!verifyPhone(phone)) {
      setErr($phone, $phone.data('text'), $errorMessage);
      return;
    }
    clearErr($phone);

    if (password.length < 6 || password.length > 20) {
      setErr($password, $password.data('text'), $errorMessage);
      return;
    }
    clearErr($password);

    if (password !== cofPassword) {
      setErr($cofPassword, $cofPassword.data('text'), $errorMessage);
      return;
    }
    clearErr($cofPassword);

    if (!agree) {
      showErr($agree.data('text'));
      return;
    }
    $errorMessage.css({'opacity': 0});

    $(this).attr('disabled', true);

    var regData = {
      phone: phone,
      password: password,
      next: next,
      source: source
    };
    register(regData);
  });
</script>
</div>
</body>
</html>